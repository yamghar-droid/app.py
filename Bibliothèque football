import streamlit as st
import pandas as pd

# 1. Configuration du style
st.set_page_config(page_title="Ballon de Plume", layout="wide")

# 2. Lien vers ton Google Sheets (PUBLIÃ‰ AU WEB en format CSV)
# REMPLACE l'URL ci-dessous par la tienne
SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTOrrGaESUYXhQUNary4l42k0kMZf-ENZOX4cPwzHourKSyWZBHnNDkFDHw30tNo-76KBYWYwZSHG2J/pub?output=csv"

@st.cache_data
def load_data(url):
    return pd.read_csv(url)

try:
    df = load_data(SHEET_URL)

    # BARRE LATÃ‰RALE
    st.sidebar.title("ðŸ“š BibliothÃ¨que")
    auteur_choisi = st.sidebar.selectbox("Choisir un rÃ©cit :", df["Nom_Auteur"])

    # FILTRAGE
    info = df[df["Nom_Auteur"] == auteur_choisi].iloc[0]

    # AFFICHAGE PRINCIPAL
    st.title(f"ðŸ“– {info['Nom_Auteur']}")
    
    col1, col2 = st.columns([1, 2])
    with col1:
        st.image(info["Portrait_URL"], use_container_width=True)
    with col2:
        st.subheader(info["Accroche"])
        st.markdown(f"**Origine :** {info['Nationalite']}")
        st.write("---")
        st.write(info["Texte_Litteraire"])

    # SECTION QUIZ
    st.write("---")
    st.subheader("ðŸ§  Le DÃ©fi du Scribe")
    choix = st.radio(info["Question_Quiz"], [info["Option_A"], info["Option_B"]])

    if st.button("Valider la rÃ©ponse"):
        if choix == info["Bonne_Reponse"]:
            st.success(f"FÃ©licitations ! Vous gagnez le badge : {info['Badge_Nom']}")
            st.balloons()
        else:
            st.error("Ce n'est pas tout Ã  fait Ã§a... RÃ©essayez !")
        st.info(f"**En savoir plus :** {info['Explication_Feedback']}")

except Exception as e:
    st.error("L'application n'arrive pas encore Ã  lire les donnÃ©es. VÃ©rifiez que votre Google Sheet est bien 'PubliÃ© sur le Web' au format CSV.")
